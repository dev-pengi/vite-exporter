# Vite Exporter Plugin

The Vite Exporter Plugin automatically generates `index.ts` files that exports all modules from a specified directory. This is useful for organizing and managing your exports in a Vite project.

## Installation

```sh
npm install vite-exporter
# or
yarn add vite-exporter
```

## Quick Start

```typescript
// vite.config.ts
import { defineConfig } from 'vite';
import { generateIndexPlugin } from 'vite-exporter';

export default defineConfig({
  plugins: [
    generateIndexPlugin({
      dirs: ['src/components', 'src/utils'],
    }),
  ],
});
```

file changes will be detected and the index.ts file will be updated automatically.

## Configuration

### Basic Configuration

```typescript
import { generateIndexPlugin, LogLevel } from 'vite-exporter';

export default defineConfig({
  plugins: [
    generateIndexPlugin({
      dirs: ['src/components', 'src/utils'],           // Required: directories to process
      extensions: ['.ts', '.tsx', '.js', '.jsx'],     // File extensions (default shown)
      debounceMs: 2000,                               // Debounce timing (default: 2000)
      logLevel: LogLevel.DEBUG,                       // Log verbosity (default: INFO)
    }),
  ],
});
```

### Advanced Per-Directory Configuration

You can now specify different matching and exclusion patterns for each directory:

```typescript
generateIndexPlugin({
  dirs: [
    // Simple string format (matches everything)
    'src/utils',
    
    // Advanced configuration with per-directory patterns
    {
      dir: 'src/components',
      match: ['**/*.tsx', '**/*.ts'],     // Only include TypeScript files
      exclude: ['**/*.test.*', '**/*.stories.*'],  // Exclude test and story files
      run: ['**/database.ts', '**/init.ts']       // Import for side effects
    },
    {
      dir: 'src/api',
      match: 'endpoints/**/*',            // Only include files in endpoints subdirectory
      exclude: ['**/*.mock.ts']           // Exclude mock files
    }
  ],
  logLevel: LogLevel.DEBUG,
});
```

### Pattern Matching

The plugin uses [minimatch](https://www.npmjs.com/package/minimatch) for pattern matching, supporting:

- `**/*` - Match all files (default)
- `**/*.tsx` - Match only .tsx files
- `components/**/*` - Match files in components subdirectory
- `!**/*.test.*` - Exclude test files (use in exclude array)
- `*.{ts,tsx}` - Match .ts or .tsx files

### Side-Effect Imports (Run Option)

The `run` option allows you to import files for their side effects even when they don't export anything:

```typescript
generateIndexPlugin({
  dirs: [
    {
      dir: 'src/setup',
      run: ['**/*.init.ts']
    }
  ]
})
```

Files matched by `run` patterns that have no exports will be imported using:
```typescript
import './backend.init.ts';
import './setup/config.init.ts';
```

## Directory Configuration Options

| Option | Type | Default | Description |
|--------|------|---------|-------------|
| `dir` | `string` | **Required** | Directory path to process |
| `match` | `string \| string[]` | `["**/*"]` | Glob patterns to include files |
| `exclude` | `string \| string[]` | `[]` | Glob patterns to exclude files |
| `run` | `string \| string[]` | `[]` | Glob patterns for side-effect imports |

## Log Levels

```typescript
LogLevel.SILENT   // No output
LogLevel.ERROR    // Only errors
LogLevel.WARN     // Errors and warnings  
LogLevel.INFO     // Standard info (default)
LogLevel.DEBUG    // Debug information
LogLevel.VERBOSE  // All details
```

## Logging Output

The new logging system provides beautiful, colored output with timestamps:

```
15:30:45 [Vite Exporter] INFO    üöÄ Plugin initialized with configuration:
‚îå‚îÄ Configuration
‚îÇ Directories: src/components, src/utils
‚îÇ Extensions: .ts, .tsx, .js, .jsx
‚îÇ Debounce: 1500ms
‚îÇ Log Level: DEBUG
‚îî‚îÄ

15:30:45 [Vite Exporter] DEBUG   üëÄ Watching directory: src/components
15:30:45 [Vite Exporter] SUCCESS üìù Generated index.ts in src/components with 5 exports
15:30:46 [Vite Exporter] DEBUG   ‚ûï File ADD: src/components/NewComponent.tsx
15:30:48 [Vite Exporter] SUCCESS üìù Generated index.ts in src/components with 6 exports
```

## Generated Files

Given this structure:
```
src/
  components/
    Button.tsx        // export default Button + named exports
    Input.tsx         // export default Input
    Select.ts         // only named exports
    database.init.ts // no exports, side effects only
```

With configuration:
```typescript
{
  dir: 'src/components',
  run: ['**/*.init.ts']
}
```

The plugin generates:
```typescript
// src/components/index.ts
// This file is auto-generated by vite-exporter-plugin
export { default as Button } from './Button';
export * from './Button';
export { default as Input } from './Input';
export * from './Select';
import './database.init.ts';
```

## Configuration Options

| Option | Type | Default | Description |
|--------|------|---------|-------------|
| `dirs` | `(string \| DirConfig)[]` | **Required** | Directories to process |
| `extensions` | `string[]` | `['.ts', '.tsx', '.js', '.jsx']` | File extensions to include |
| `debounceMs` | `number` | `2000` | Debounce timing in milliseconds |
| `logLevel` | `LogLevel` | `LogLevel.INFO` | Logging verbosity level |

## Examples

### Component Library with Tests
```typescript
generateIndexPlugin({
  dirs: [
    {
      dir: 'src/components',
      match: ['**/*.tsx', '**/*.ts'],
      exclude: ['**/*.test.*', '**/*.stories.*', '**/__tests__/**']
    }
  ]
})
```

### API Endpoints Only
```typescript
generateIndexPlugin({
  dirs: [
    {
      dir: 'src/api',
      match: 'endpoints/**/*.ts',
      exclude: ['**/*.mock.ts', '**/*.spec.ts']
    }
  ]
})
```

### Setup with Initialization Files
```typescript
generateIndexPlugin({
  dirs: [
    {
      dir: 'src/setup',
      match: ['**/*.ts'],
      run: ['**/*.init.ts', '**/database.ts']  // Import these for side effects
    }
  ]
})
```

### Multiple Directories with Different Rules
```typescript
generateIndexPlugin({
  dirs: [
    'src/utils',  // Simple: match everything
    {
      dir: 'src/components',
      exclude: ['**/*.test.*', '**/*.stories.*']
    },
    {
      dir: 'src/hooks',
      match: 'use*.ts'  // Only hook files
    },
    {
      dir: 'src/config',
      run: ['env.ts', 'database.ts']  // Side-effect imports
    }
  ]
})
```

## Troubleshooting

**Enable verbose logging to see everything:**
```typescript
generateIndexPlugin({
  dirs: ['src/components'],
  logLevel: LogLevel.VERBOSE,
})
```

**Common issues:**
- Files not detected ‚Üí Check `extensions` configuration and `match` patterns
- Too many updates slow down the build ‚Üí Increase `debounceMs` value  
- Files excluded ‚Üí Check `exclude` patterns and ensure they use forward slashes
- Side-effect imports not working ‚Üí Ensure files match `run` patterns and have no exports

## Migration Guide

### From v1.x to v2.x

```typescript
// Old (v1.x)
generateIndexPlugin({
  dirs: ['src/components'],
  excludes: ['**/*.test.ts', '**/*.spec.ts'],  // Global excludes
  enableDebugging: true,
  enableDebuggingVerbose: true,
})

// New (v2.x)
generateIndexPlugin({
  dirs: [
    "src/utils",
    {
      dir: 'src/components',
      // not match pattern/patterns so all files will be imported from
      exclude: ['**/*.test.ts', '**/*.spec.ts']  // Per-directory excludes
    }
  ],
  logLevel: LogLevel.VERBOSE,
})
```

## License

MIT License